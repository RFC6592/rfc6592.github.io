---
layout: post
title: Suricata CVE-2025-69258 MsgReceiver.exe LoadLibraryEx RCE (CVSS 9.8)
subtitle: There's lots to learn!
tags: [CyberSec]
comments: true
---

## Suricata Rule

![Alt text](https://rfc6592.github.io/assets/img/CVE-CVE-2025-69258-CVSS.png)

alert tcp any any -> any 20001 (
    msg:"POTENTIAL RCE MsgReceiver LoadLibraryEx (MsgId 0x0a8d) - Apex Central";
    flow:established,to_server;
    content:"|8d 0a|"; offset:13; depth:2;
    content:"|5c 5c|"; nocase;
    content:".dll"; nocase;
    classtype:attempted-admin;
    reference:cve,CVE-2025-69258;
    metadata: vendor TrendMicro;
    sid:9000010;
    rev:1;
)

Solution :
Upgrade to build 7190 or later.

## Synopsis


MsgReceiver.exe listens on default TCP port 20001 and accepts messages having the following structures:
```c
// be = big endian
// le = little endian

struct hdr
{
   be32 MsgSize; // for entire message
   byte unk[9];
};

 

struct body
{
   le16 MsgId; // 0x08ff - SC_QUERY_PROCESS_ID_REQUEST
               // 0x0900 - SC_QUERY_PROCESS_ID_REPLY
               // 0x08fd - SC_UNLOAD_REQUEST
               // 0x08fe - SC_UNLOAD_REPLY
               // 0x0a8d - SC_INSTALL_HANDLER_REQUEST
               // 0x0a8e - SC_INSTALL_HANDLER_REPLY
               // 0x0901 - SC_UPDATE_DEBUG_MODE_REQUEST
               // 0x0a8f - FwdMsg2LogInterceptors
               // 0x1b5b - SC_CMD_CGI_LOG_REQUEST
               // [...]

   byte data[hdr.MsgSize-15]; // message-specific data
};


struct msg

{
   hdr h;
   body b;
};


struct x_astring
{
   le32 size;        // string size
   byte data[size];  // string data, null-terminated
};

struct msg_0a8d
{
   hdr h;  
   le16 MsgId;         // must be 0x0a8d
   x_astring handler;  // interceptor handler DLL name
   le32 flag;          // 1 - install handler, 0 - uninstall handler
};

Message 0x0a8d includes the name of a DLL to be loaded via LoadLibraryEx():

// msgHandlerLogReceiver.dll, file version 8.0.0.7052
[...]
.text:10086012  push    LOAD_WITH_ALTERED_SEARCH_PATH
.text:10086014  push    0
.text:10086016  push    edi             ; VULN: attacker-controlled DLL
.text:10086016                          ; e.g., \\<attacker-host>\share\evil.dll
.text:10086017  call    ds:LoadLibraryExA
[...]
```
An unauthenticated remote attacker can send message 0x0a8d to load an attacker-controlled DLL into MsgReceiver.exe, leading to execution of attacker-supplied code under the security context of SYSTEM.

## PoC (Loading...)
[...]
